# 剩余任务

任务分配计划

## 任务模块划分

### 模块1：预约管理后端 API

**负责人**: 组员1（后端开发）

**任务内容**:

1. 创建预约 Service 层 (`app/services/reservation_service.py`)

- `create_reservation()` - 创建预约（学生/教师）

- `get_reservation_list()` - 获取预约列表（支持筛选：用户ID、设备ID、状态）

- `get_reservation_by_id()` - 获取预约详情

- `update_reservation_status()` - 更新预约状态（审批）

- `delete_reservation()` - 删除预约

2. 创建预约 Schema (`app/api/v1/schemas/reservation_schema.py`)

- `ReservationSchema` - 预约序列化

- `ReservationCreateSchema` - 创建预约验证

- `ReservationUpdateSchema` - 更新预约验证

- `ReservationQuerySchema` - 查询参数验证

3. 创建预约 API 路由 (`app/api/v1/reservation.py`)

- `POST /api/v1/reservations/` - 创建预约（需要登录）

- `GET /api/v1/reservations/` - 获取我的预约列表（需要登录）

- `GET /api/v1/reservations/<id>` - 获取预约详情（需要登录）

- `PUT /api/v1/reservations/<id>/cancel` - 取消预约（需要登录，只能取消自己的）

4. 创建管理员预约审批 API (`app/api/v1/admin.py` 中扩展)

- `GET /api/v1/admin/reservations/` - 获取所有预约列表（管理员）

- `PUT /api/v1/admin/reservations/<id>/approve` - 审批通过（管理员）

- `PUT /api/v1/admin/reservations/<id>/reject` - 审批拒绝（管理员）

5. 实现业务逻辑：

- 预约时填充冗余字段（user_name, equip_name, price等）

- 预约状态流转：0-待审 → 1-通过 → 2-拒绝 → 3-已取消

- 添加 Redis 缓存（预约列表缓存）

**参考文件**:

- `app/models/reservation.py` - 预约模型

- `app/services/equipment_service.py` - 参考 Service 层实现

- `app/api/v1/equipment.py` - 参考 API 路由实现

---

### 模块2：预约管理前端页面

**负责人**: 组员2（前端开发）**任务内容**:

1. 创建预约 API 封装 (`frontend/src/api/reservation.js`)

- `createReservation()` - 创建预约

- `getReservationList()` - 获取预约列表

- `getReservationById()` - 获取预约详情

- `cancelReservation()` - 取消预约

- `approveReservation()` - 审批通过（管理员）

- `rejectReservation()` - 审批拒绝（管理员）

2. 完善预约管理页面 (`frontend/src/views/Reservations.vue`)

- 我的预约列表（Tab：全部/待审批/已通过/已拒绝/已取消）

- 创建预约表单（选择设备、选择时间段、填写预约信息）
- 预约详情展示

- 取消预约功能

- 预约状态筛选和搜索

3. 在设备详情页添加预约按钮 (`frontend/src/views/EquipmentDetail.vue`)

- 添加"立即预约"按钮（非管理员可见）

- 点击后弹出预约表单对话框

- 预约成功后提示并刷新

4. 管理员预约审批页面（可选，或集成到管理员后台）

- 待审批预约列表

- 审批操作（通过/拒绝）

- 审批理由输入

**参考文件**:

- `frontend/src/views/Equipment.vue` - 参考列表页面实现

- `frontend/src/api/equipment.js` - 参考 API 封装

---

### 模块3：时间段管理后端 API

**负责人**: 组员3（后端开发）

**任务内容**:

1. 创建时间段 Service 层 (`app/services/timeslot_service.py`)

- `get_timeslots_by_equipment()` - 获取设备的时间段列表

- `create_timeslot()` - 创建时间段（管理员）

- `update_timeslot()` - 更新时间段（管理员）

- `delete_timeslot()` - 删除时间段（管理员）

- `get_available_timeslots()` - 获取可用时间段（排除已预约的）

2. 创建时间段 Schema (`app/api/v1/schemas/timeslot_schema.py`)

- `TimeSlotSchema` - 时间段序列化

- `TimeSlotCreateSchema` - 创建时间段验证

- `TimeSlotUpdateSchema` - 更新时间段验证

3. 创建时间段 API 路由 (`app/api/v1/timeslot.py`)

- `GET /api/v1/timeslots/equipment/<equip_id>` - 获取设备时间段列表（需要登录）

- `GET /api/v1/timeslots/equipment/<equip_id>/available` - 获取可用时间段（需要登录，用于预约）

4. 创建管理员时间段管理 API (`app/api/v1/admin.py` 中扩展)

- `POST /api/v1/admin/timeslots/` - 创建时间段（管理员）

- `PUT /api/v1/admin/timeslots/<id>` - 更新时间段（管理员）

- `DELETE /api/v1/admin/timeslots/<id>` - 删除时间段（管理员）

5. 实现业务逻辑：

- 时间段冲突检测（同一设备不能有重叠时间段）

- 时间段激活/禁用功能

- 与预约系统集成（查询可用时间段时排除已预约）

**参考文件**:

- `app/models/timeslot.py` - 时间段模型

- `app/services/equipment_service.py` - 参考 Service 层实现

---

### 模块4：审计日志功能

**负责人**: 组员4（全栈开发）

**任务内容**:

1. 创建审计日志 Service 层 (`app/services/auditlog_service.py`)

- `create_audit_log()` - 创建日志记录

- `get_audit_log_list()` - 获取日志列表（支持筛选：操作人、操作类型、时间范围）

- `get_audit_log_by_id()` - 获取日志详情

2. 创建审计日志 Schema (`app/api/v1/schemas/auditlog_schema.py`)

- `AuditLogSchema` - 日志序列化

- `AuditLogQuerySchema` - 查询参数验证

3. 创建审计日志 API 路由 (`app/api/v1/auditlog.py`)

- `GET /api/v1/auditlogs/` - 获取日志列表（管理员）

- `GET /api/v1/auditlogs/<id>` - 获取日志详情（管理员）

4. 创建审计日志装饰器 (`app/utils/audit.py`)

- `@audit_log(action_type)` - 自动记录操作日志的装饰器

- 在关键操作上添加装饰器（设备增删改、预约审批等）

5. 创建前端审计日志页面 (`frontend/src/views/AuditLog.vue`)

- 日志列表展示（表格）

- 筛选功能（操作人、操作类型、时间范围）

- 日志详情查看

- 分页功能

6. 创建前端 API 封装 (`frontend/src/api/auditlog.js`)

**参考文件**:

- `app/models/auditlog.py` - 审计日志模型

- `app/utils/auth.py` - 参考装饰器实现

---

### 模块5：管理员后台前端页面

**负责人**: 组员5（前端开发）

**任务内容**:

1. 创建管理员后台布局 (`frontend/src/views/AdminDashboard.vue`)

- 侧边栏导航（设备管理、预约审批、用户管理、审计日志、数据统计）

- 顶部导航栏（用户信息、退出登录）

- 主内容区域（路由视图）

2. 创建预约审批页面 (`frontend/src/views/admin/ReservationApproval.vue`)

- 待审批预约列表

- 预约详情查看

- 审批操作（通过/拒绝，带理由）

- 已审批预约历史

3. 创建用户管理页面 (`frontend/src/views/admin/UserManagement.vue`)

- 用户列表（学生/教师/管理员）

- 用户搜索和筛选

- 用户详情查看

- 用户状态管理（激活/禁用）

4. 创建数据统计页面 (`frontend/src/views/admin/Statistics.vue`)

- 设备统计（总数、可用数、使用率）

- 预约统计（总预约数、通过率、拒绝率）

- 用户统计（各角色人数）

- 图表展示（使用 Element Plus 或 ECharts）

5. 更新路由配置 (`frontend/src/router/index.js`)

- 添加管理员后台路由（需要管理员权限）

- 路由守卫检查管理员权限

**参考文件**:

- `frontend/src/views/Equipment.vue` - 参考列表页面

- `frontend/src/stores/user.js` - 用户状态管理

---

### 模块6：帮助中心 + 系统优化

**负责人**: 组员6（前端开发 + 测试）

**任务内容**:

1. 创建帮助中心页面 (`frontend/src/views/Help.vue`)

- 常见问题（FAQ）

- 使用指南（如何预约、如何审批等）

- 联系支持

- 搜索功能

2. 系统优化和测试

- 前端页面响应式优化（移动端适配）

- 性能优化（图片懒加载、路由懒加载）

- 错误处理优化（统一错误提示）

- 单元测试（可选）

3. 文档完善

- API 文档补充（Swagger 注释完善）

- 代码注释完善

- 用户使用手册（可选）

4. 其他功能

- 首页优化（添加更多内容）

- 404 页面

- 加载动画优化

**参考文件**:

- `frontend/src/views/Home.vue` - 首页参考

---

## 开发注意事项

1. **代码规范**: 遵循项目现有的代码风格和架构模式

2. **API 统一**: 所有 API 响应格式统一为 `{code, msg, data}`

3. **权限控制**: 使用 `@login_required` 和 `@admin_required` 装饰器

4. **缓存策略**: 读操作使用 Redis 缓存，写操作清除相关缓存

5. **错误处理**: 使用统一的异常处理机制

6. **前端路由**: 需要登录的路由添加 `requiresAuth: true`，需要管理员的路由添加 `requiresAdmin: true`

## 任务依赖关系

```javascript
模块1（预约后端） → 模块2（预约前端）
模块3（时间段后端） → 模块2（预约前端需要时间段）
模块1 + 模块3 → 模块4（审计日志需要记录预约和时间段操作）
模块1 + 模块4 → 模块5（管理员后台需要预约审批和日志查看）
模块6（帮助中心）可独立开发
```



## 建议开发顺序

1. **第一阶段**（并行）: 模块1、模块3、模块6
2. **第二阶段**（并行）: 模块2、模块4